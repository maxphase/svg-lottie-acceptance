<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SVG Viewer Example</title>

  <style>
    body {
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #wrapper {
      background-color: white;
      padding: 20px;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }
    #svg-container {
      background-color: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-right: 25px; /* Adjusted margin right */
      width: var(--svg-width, 500px); /* default to 500px if not set */
      height: var(--svg-height, 500px); /* default to 500px if not set */
    }
    #svg-container svg {
      width: 100%;
      height: 100%;
      display: block; /* This can help remove any extra space below the SVG */
    }
    #input-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-left: 25px; /* Adjusted margin left */
    }
    #svg-input {
      width: 100%;
      height: calc(100vh - 40px);
    }
    #input-container.dragover {
      border: 2px dashed #4CAF50;
      background-color: #f0f0f0;
    }
  </style>

  <script>
    // Default size
    const DEFAULT_WIDTH = '500px';
    const DEFAULT_HEIGHT = '500px';

    // Placeholders to be replaced by Playwright
    const WIDTH_PLACEHOLDER = '%%WIDTH%%';
    const HEIGHT_PLACEHOLDER = '%%HEIGHT%%';

    // Determine the actual width and height
    const width = WIDTH_PLACEHOLDER === '%%WIDTH%%' ? DEFAULT_WIDTH : WIDTH_PLACEHOLDER;
    const height = HEIGHT_PLACEHOLDER === '%%HEIGHT%%' ? DEFAULT_HEIGHT : HEIGHT_PLACEHOLDER;

    // Function to set the size of the SVG container
    function setSVGSize() {
      const svgContainer = document.querySelector('#svg-container');
      svgContainer.style.setProperty('--svg-width', width);
      svgContainer.style.setProperty('--svg-height', height);
    }


    function readSVGFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        document.querySelector('#svg-input').value = e.target.result;
        document.querySelector('#load-svg').click(); // Simulate button click to load SVG
      };
      reader.readAsText(file);
    }

    function setupPageDragAndDrop() {
      // Listen to dragover event on the entire page
      document.addEventListener('dragover', (event) => {
          event.stopPropagation();
          event.preventDefault();
          event.dataTransfer.dropEffect = 'copy'; // Show as copy
      });

      // Listen to drop event on the entire page
      document.addEventListener('drop', (event) => {
          event.stopPropagation();
          event.preventDefault();

          const files = event.dataTransfer.files; // Access the dropped files
          if (files.length > 0 && files[0].type === 'image/svg+xml') {
              readSVGFile(files[0]); // Call readSVGFile function if an SVG file is dropped
          }
      });
  }

    // Call setup function on DOMContentLoaded
    window.addEventListener('DOMContentLoaded', () => {
      setSVGSize();
      setupPageDragAndDrop();
    });
  </script>

</head>
<body>
  <div id="wrapper">
    <div id="svg-container" data-test-id="svg-container">
      <!-- The SVG content will be loaded here -->
    </div>
    <div id="input-container">
      <input type="file" id="file-chooser" accept=".svg" data-test-id="file-chooser" style="margin-bottom: 10px; margin-top: 20px;"/>
      <textarea id="svg-input" placeholder="Paste raw SVG code here" data-test-id="svg-input"></textarea>
      <button id="load-svg" data-test-id="svg-load-button">Load SVG</button>
    </div>
  </div>
  <script>
    const loadButton = document.querySelector('#load-svg');
    const svgInput = document.querySelector('#svg-input');
    const svgContainer = document.querySelector('#svg-container');
    const fileChooser = document.querySelector('#file-chooser'); // File chooser for uploading SVG

    loadButton.addEventListener('click', () => {
      // Assume the input is raw SVG code
      const svgContent = svgInput.value;
      // Clear the container
      svgContainer.innerHTML = '';
      // Set the innerHTML of the container to the SVG code
      svgContainer.innerHTML = svgContent;
    });

    // Add event listener for the file chooser
    fileChooser.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file && file.type === 'image/svg+xml') {
        readSVGFile(file); // Read the SVG file
      }
    });

    setupPageDragAndDrop();
  </script>
</body>
</html>
